=head1 NAME

urpmi - téléchargement, installation et résolution de dépendances de rpm

=head1 SYNOPSIS

    urpmi [options] [noms_paquetages | fichiers_rpm...]

=head1 DESCRIPTION

Le rôle d'urpmi est d'installer des paquetages rpm, ainsi que leurs
dépendances. Il peut aussi être utilisé pour installer les dépendances
de fabrication d'un srpm (paquetage source d'un rpm), ou les dépendances de
fabrication à partir du fichier spec d'un rpm; ou bien installer un
paquetage source lui-même afin de le refabriquer plus tard.

Urpmi peut-être comparé à rpm, comme insmod l'est avec modprobe, ou
dpkg avec apt-get. Lancez juste urpmi avec ce que vous pensez être le nom
du paquetage et urpmi va :

=over 4

=item *

Proposer différents noms de paquetages si le nom est ambigü et sortir.

=item *

Si un seul paquetage est trouvé, vérifier si les dépendances sont déjà
installées.

=item *

Si ça n'est pas le cas, proposer d'installer les dépendances et en cas
d'acceptation, réalise cette opération.

=item *

Terminer par l'installation du ou des paquetages demandés.

=back

Urpmi supporte les installations à partir de divers supports (ftp, http,
rsync, volumes locaux ou nfs, supports amovibles tels que CDROMs ou DVDs)
et est capable d'installer les dépendances à partir d'un support différent
de celui du paquetage. Pour les supports amovibles, urpmi peut vous
demander d'insérer le disque adéquat si nécessaire.

Pour ajouter un nouveau support contenant des rpms, lancez C<urpmi.addmedia>.
Pour supprimer un support existant, utilisez C<urpmi.removemedia>.
Pour mettre à jour la liste des paquetages (par exemple si l'archive ftp
a été modifiée), utilisez C<urpmi.update>.

=head1 OPTIONS

=over

=item B<--help>

Afficher un message d'aide et sortir (même chose que B<-h> or B<-?>).

=item B<--update>

N'utiliser que le support de mise à jour. Cela signifie qu'urpmi ne
cherchera les paquetages et ne résoudra les dépendances que sur le
support de mise à jour.

=item B<--media> I<media1,...,mediaN>

Selectionner un support spécifique a utiliser, au lieu d'utiliser
par défaut tous les supports disponibles (ou tous les supports de mise
à jour si B<--update> est précisé).
Aucun rpm ne sera récupéré sur un autre support.

=item B<--excludemedia> I<media1,...,mediaN>

Ne pas utiliser le ou les supports spécifiés.

=item B<--searchmedia> I<media>

N'utiliser que le support précisé pour rechercher les paquetages listés
dans la ligne de commande, ou qui sont trouvés grâce à B<--auto-select>.
Les dépendances de ces paquetages peuvent cependant être trouvées sur un
autre support.

=item B<--sortmedia> I<media1,...,mediaN>

Définir l'ordre d'utilisation des supports spécifiés. Des sous-chaines
peuvent être utilisées pour désigner plus simplement plusieurs supports.
Avec cette option, C<media1> sera utilisé en premier, puis le C<media2>, et
ainsi de suite. Les supports non listés sont pris en compte après les autres.

=item B<--synthesis> I<fichier>

Utiliser le fichier de synthèse précisé au lieu de celui de la base urpmi pour
rechercher les paquetages et résoudre les dépendances.

=item B<--auto>

Installer toutes les dépendances requises automatiquement.

=item B<--auto-select>

Sélectionner tous les paquetages qui peuvent être mis à jour, en comparant
les paquetages installés et ceux présents sur les supports déclarés.

=item B<--auto-update>

Comme B<--auto-select>, mais mettre à jour les supports avant de sélectionner
les paquetages à mettre à jour. Ceci évite d'appeler C<urpmi.update> avant.

=item B<--no-install>

Télécharger seulement les paquetages sans les installer. Après l'opération
ils seront dans F</var/cache/urpmi/rpms>.

=item B<--no-uninstall>

Ne pas demander la désinstallation d'un paquetage mais interrompre plutôt.
Ceci peut être plus prudent en mode automatique.

=item B<--keep>

Quand certaines dépendances ne peuvent pas être satisfaites, modifier la
sélection des paquetages pour conserver les paquetages installés au lieu de
les désinstaller. Ce comportement bloque généralement la mise à jour des
paquetages listés dans la ligne de commande (ou en utilisant B<--auto-select>)
lorsque qu'une erreur de dépendance se produit.

=item B<--split-level> I<nombre>

Eclater l'opération urpmi en plusieurs petites transactions lorsque
le nombre de paquetages à mettre à jour est supérieur au I<nombre> précisé.
Cette option est active par défaut et la valeur par défaut de I<nombre>
est 20.

=item B<--split-length> I<nombre>

Eclater l'opération urpmi en plusieurs petites transactions d'au
minimum I<nombre> paquetages. La valeur par défaut est 1 et mettre une
valeur de 0 désactive l'éclatement en plusieurs transactions.

=item B<--fuzzy>

Désactiver la recherche rapide sur le nom exact du paquetage; cela
signifie qu'urpmi proposera tous les paquetages dont le nom correspond,
même si l'un d'entre eux correspond exactement au nom spécifié (c'est
équivalent de B<-y>).

=item B<--src> I<nom>

Rechercher un paquetage source correspondant à I<nom> et sélectionner toutes
ses dépendances (c'est à dire ses C<BuildRequires>) par défaut, sauf si
l'option B<--install-src> est utilisée pour installer le paquetage source
lui-même. (Vous pouvez aussi installer les dépendances de fabrication
directement à partir d'un fichier spec de rpm).

=item B<--install-src>

Installer uniquement le paquetage source (c'est à dire qu'aucun paquetage
binaire ne sera installé). Il n'est pas nécessaire d'être root pour utiliser
cette option (vous devez cependant avoir les droits d'écriture sur votre
arborescence de fabrication des paquetages).

=item B<--clean>

Supprimer tous les paquetages du répertoire cache F</var/cache/urpmi/rpms>.

=item B<--noclean>

N'enlever aucun paquetage du répertoire cache F</var/cache/urpmi/rpms>.

=item B<--force>

Répondre oui à toutes les questions.

=item B<--allow-nodeps>

Avec cette option, urpmi demandera à l'utilisateur lorsqu'une erreur se
produit si l'installation doit se poursuivre sans vérifier les dépendances.
Par défaut, urpmi sort immédiatement dans ce cas.

=item B<--allow-force>

Avec cette option, urpmi demandera à l'utilisateur lorsqu'une erreur se
produit si l'installation doit être forcée. Par défaut, urpmi sort
immédiatement dans ce cas.

=item B<--parallel> I<alias>

Activer l'exécution distribuée d'urpmi sur plusieurs machines (urpmi doit
être obligatoirement installé, mais il n'est pas nécessaire d'avoir un support
défini sur ces machines). I<alias> définit quel module d'extension doit
être utilisé par urpmi (actuellement, C<urpmi-parallel-ka-run> ou
C<urpmi-parallel-ssh> sont disponibles) et quelles machines doivent être
mises à jour. Cet alias est défini dans le fichier F</etc/urpmi/parallel.cfg>
comme décrit ci-dessous.

=item B<--root> I<répertoire>

Utiliser le I<répertoire> en mode chroot pour installer les paquetages.
Toutes les opérations et les scripts seront lancés après un chroot(2).
La base de données rpm qui repose dans l'arborescence cible sera
utilisée mais la configuration d'urpmi sera celle du système normal.

=item B<--use-distrib> I<répertoire>

Configurer urpmi à la volée à partir d'une arborescence de distribution, utile
pour installer en mode chroot grâce à l'option B<--root>. Consultez la description
de l'option B<--distrib> dans la page du manuel de C<urpmi.addmedia>.

=item B<--wget>

Utiliser wget pour le téléchargement des fichiers distants. Par défault, curl est
utilisé en priorité s'il est disponible, et wget sinon.

=item B<--curl>

Utiliser curl pour le téléchargement des fichiers distants. Par défault, curl est
utilisé en priorité s'il est disponible, et wget sinon.

=item B<--curl-options> I<'options'>

=item B<--rsync-options> I<'options'>

=item B<--wget-options> I<'options'>

Spécifier des options additionnelles qui doivent être passées à curl, rsync
ou wget pour le téléchargement des fichiers. Si plusieurs options doivent
être passées, séparez-les par des espaces et encadrez-les de guillemets.

=item B<--limit-rate> I<débit>

Essayer de limiter la vitesse de téléchargement. I<débit> est exprimé en
octets/sec. Cette option est désactivée par défaut.

=item B<--resume>

Continuer le transfert des fichiers partiellement téléchargés.

=item B<--retry> I<nombre>

Retenter I<nombre> de fois le téléchargement des fichiers via ftp ou http.

=item B<--proxy> I<proxyhost[:port]>

Utiliser le proxy HTTP spécifié.

=item B<--proxy-user> I<utilisateur:mot_de_passe>

Utiliser l'utilisateur et le mot de passe spécifiés lors de l'authentification
du proxy. La syntaxe B<--proxy-user=ask> forcera urpmi a demander un utilisateur
et un mot de passe.

=item B<--bug> I<répertoire>

Créer un rapport de bogue dans I<répertoire>. Vous devrez envoyer une archive
compressée du répertoire au mainteneur d'urpmi afin de tenter de reproduire
(dans la mesure du possible) l'anomalie.

=item B<--env> I<répertoire>

Utiliser un environnement différent directement à partir d'un rapport d'anomalie
afin de la reproduire. L'argument est le même que celui donné à l'option B<--bug>.

=item B<--verify-rpm>

=item B<--no-verify-rpm>

Activer ou désactiver la vérification de la signature du rpm. La vérification
est activée par défaut.

=item B<--test>

Tester l'installation des paquetages mais sans réellement installer quoique
ce soit ni modifier le système. (C'est l'équivalent de C<rpm --test>).

=item B<--excludepath> I<chaine>

Ne pas installer les fichiers dont le nom commence par I<chaine> (comme
C<rpm --excludepath>).

=item B<--excludedocs>

Ne pas installer les fichiers de documentation (comme C<rpm --excludedocs>).

=item B<--ignorearch>

Autoriser l'installation des paquetages qui ne correspondent pas à l'architecture
de la machine hôte. C'est l'équivalent de C<rpm --ignorearch>.

=item B<--ignoresize>

Ne pas vérifier la taille disponible sur le système de fichiers avant l'installation.
C'est l'équivalent de C<rpm --ignoresize>.

=item B<--repackage>

Sauvegarder l'état des paquetages mis à jour; en d'autres termes, sauvegarder
les anciens paquetages (généralement dans F</var/spool/repackage> mais vous
pouvez modifier cela par une macro rpm). C'est l'équivalent de l'option
B<--repackage> de la commande rpm.

I<Note:> si vous utilisez C<urpmi.recover> pour activer la politique de
sauvegarde des paquetage, vous n'avez pas besoin de cette option car
C<urpmi.recover> surchargera globalement la macro rpm permettant la sauvegarde
des transactions de re-génération des paquetages sur l'ensemble du système.

=item B<--noscripts>

Ne pas exécuter les scriptlets.
C'est l'équivalent de C<rpm --noscripts>.

=item B<--skip> I<motif,...>

Vous pouvez spécifier une liste de paquetages dont l'installation doit être
sautée. Vous pouvez aussi inclure des motifs encadrés par //, exactement
comme dans F</etc/urpmi/skip.list> (voir urpmi.files(5)).

=item B<--more-choices>

Quand plusieurs paquetages sont trouvés, proposer plus de choix que celui
par défaut.

=item B<--nolock>

Ne pas verrouiller la base de données rpm et urpmi. Cela peut être utile conjugué
avec l'option B<--root>.

=item B<--norebuild>

Ne pas tenter de reconstruire les fichiers hdlist à partir des paquetages si le
hdlist original n'était pas lisible ou était corrompu.

=item B<--strict-arch>

Ne mettre à jour les paquetages que si la nouvelle version correspond à
l'architecture installée. Principalement utile pour les machines qui supportent
plusieurs architectures (32 et 64 bit).

=item B<-a>

Si plusieurs paquetages correspondent au nom donné, les installer tous.

=item B<-p>

Autoriser la recherche dans les applications que fournit le paquetage (c'est
le comportement par défaut)

=item B<-P>

Ne pas rechercher dans les applications que fournit le paquetage (c'est
l'opposé de B<-p>).

=item B<-y>

C'est l'équivalent de B<--fuzzy>.

=item B<-s> I<nom>

C'est l'équivalent de B<--src>.

=item B<-q>

Mode silencieux : lors de l'appel d'un paquetage aucun message de mise à jour
n'est affiché.

=item B<-v>

Propose un mode bavard avec différents messages.

=back

=head1 EXEMPLES

    urpmi ssh://foo@bar.net/home/foo/test.rpm

Récupérer F</home/foo/test.rpm> sur le serveur bar.net via ssh en tant
qu'utilisateur foo.
Vous pouvez utiliser votre clé publique ou entrer votre mot de passe.

    urpmi --media foo- --auto-select

Récupérer toutes les mises à jour sur les supports contenant C<foo-> dans leur nom.

=head1 FICHIERS

Voir urpmi.files(5).

=head1 CODES DE SORTIE

=over

=item 1

Incohérence de la ligne de commande.

=item 2

Problèmes d'enregistrement des paquetages locaux.

=item 3

Impossibilité de récupérer le paquetage source.

=item 4

Support non sélectionné.

=item 5

Support déjà existant.

=item 6

Impossibilité de sauvegarder la configuration.

=item 7

Base de données urpmi verrouillée.

=item 8

Impossibilité de lire ou écrire un rapport d'anomalie.

=item 9

Impossibilité d'ouvrir rpmdb.

=item 10

Certains fichiers manquent pour l'installation.

=item 11

Certaines transactions ont échoué mais pas toutes.

=item 12

Toutes les transactions ont échoué.

=item 13

Certains fichiers manquent et quelques transactions ont échoué mais pas toutes.

=item 14

Certains fichiers manquent et toutes les transactions ont échoué.

=back

=head1 RAPPORT D'ANOMALIE

Si vous trouvez une anomalie dans urpmi, merci de la rapporter et
utilisant la commande :

    urpmi --bug répertoire_anomalie ...

Ceci va créer automatiquement un répertoire appelé F<répertoire_anomalie>
contenant les fichiers nécessaires pour le reproduire si possible. Merci
de tester le rapport en utilisant :

    urpmi --env répertoire_anomalie ...

afin de vérifier si l'anomalie est toujours présente. Evidemment, seules
les anomalies reproductibles ont une chance d'être résolues. Pour envoyer le rapport
d'anomalie, créez un fichier tarball de ce répertoire et envoyez le directement
au mainteneur courant avec la description de ce qui, d'après vous, ne va pas.

=head1 AUTEUR

Pascal Rigaux (auteur original), François Pons,
Rafael Garcia-Suarez, <rgarciasuarez@mandriva.com> (maintaineur courant)

=head1 VOIR AUSSI

urpmi.addmedia(8), urpmi.update(8), urpmi.removemedia(8), urpme(8),
urpmf(8), urpmq(8), urpmi.cfg(5), urpmi.files(5).

=head1 TRADUCTION

Christophe Berthelé 2006
